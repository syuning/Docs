<nz-modal [(nzVisible)]="isCreateModalVisible" [nzTitle]="modalTitle" [nzContent]="modalContent" [nzFooter]="modalFooter"
  (nzOnCancel)="handleCreateCancel()">
  <ng-template #modalTitle>
    <p>创建用户</p>
  </ng-template>

  <ng-template #modalContent>
    <form nz-form [formGroup]="createUserForm" (ngSubmit)="submitCreateUserForm()">
      <nz-form-item>
        <nz-form-label [nzSm]="6" [nzXs]="24" nzRequired>用户名</nz-form-label>
        <nz-form-control [nzSm]="14" [nzXs]="24">
          <input nz-input formControlName="username" placeholder="请输入用户名">
          <nz-form-explain *ngIf="createUserForm.get('username').dirty && createUserForm.get('username').errors">请输入长度在1-100个字符之间的用户名！</nz-form-explain>
        </nz-form-control>
      </nz-form-item>

      <nz-form-item>
        <nz-form-label [nzSm]="6" [nzXs]="24" nzRequired>用户角色</nz-form-label>
        <nz-form-control [nzSm]="14" [nzXs]="24">
          <div>
            <nz-radio-group formControlName="role" [nzButtonStyle]="'solid'">
                <label nz-radio-button [nzValue]="userType.value" *ngFor="let userType of userTypes">{{ userType.label }}</label>
            </nz-radio-group>
          </div>
          <nz-form-explain *ngIf="createUserForm.get('role').dirty && createUserForm.get('role').errors">请选择用户角色！</nz-form-explain>
        </nz-form-control>
      </nz-form-item>

      <nz-form-item>
        <nz-form-label [nzSm]="6" [nzXs]="24" nzFor="password" nzRequired>密码</nz-form-label>
        <nz-form-control [nzSm]="14" [nzXs]="24">
          <nz-tooltip [nzPlacement]="'right'" [nzOverlayClassName]="'nzi-help-box'">
            <input nz-input type="password" formControlName="password" (ngModelChange)="updateConfirmValidator()"
              placeholder="请输入密码" nz-tooltip #box (keyup)="0">
            <nz-form-explain *ngIf="createUserForm.get('password').dirty && createUserForm.get('password').invalid || createUserForm.get('password').pending ">
              <ng-container *ngIf="createUserForm.get('password').hasError('required')">
                请输入用户密码！
              </ng-container>
              <ng-container *ngIf="createUserForm.get('password').hasError('invalid')">
                输入的用户密码无效!
              </ng-container>
              <ng-container *ngIf="createUserForm.get('password').pending">
                验证中...
              </ng-container>
            </nz-form-explain>
            <div style="width: 83%">
              <nzi-password-level [level]='nziPasswordLevel.judgeStrength(box.value,8)' #nziPasswordLevel></nzi-password-level>
            </div>
            <ng-template #nzTemplate>
              <div>密码长度8-32位
                <br> 必须包含大小写字母和数字
                <br> 支持英文特殊字符{{'!"$%+,/:<=>?[]^-`{}|~'
                  <nzi-password-level [level]='"level3"'></nzi-password-level>
              </div>
            </ng-template>
          </nz-tooltip>
        </nz-form-control>
      </nz-form-item>

      <nz-form-item>
        <nz-form-label [nzSm]="6" [nzXs]="24" nzRequired>确认密码</nz-form-label>
        <nz-form-control [nzSm]="14" [nzXs]="24">
          <input nz-input type="password" formControlName="checkPassword" placeholder="请再次输入密码">
          <nz-form-explain *ngIf="createUserForm.get('checkPassword').dirty && createUserForm.get('checkPassword').errors">
            <ng-container *ngIf="createUserForm.get('checkPassword').hasError('required')">
              请再次输入你的密码！
            </ng-container>
            <ng-container *ngIf="createUserForm.get('checkPassword').hasError('confirm')">
              两次输入的密码值不同！
            </ng-container>
          </nz-form-explain>
        </nz-form-control>
      </nz-form-item>

    </form>
  </ng-template>

  <nz-spin [nzSpinning]="isButtonLoading">
  <ng-template #modalFooter>
    <button nz-button nzType="default" (click)="handleCreateCancel()">取消</button>
    <button nz-button nzType="primary" (click)="createUser()" [disabled]="!createUserForm.valid">确定</button>
  </ng-template>
</nz-spin>

</nz-modal>
